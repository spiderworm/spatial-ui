<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, user-scalable=no">
<link rel="stylesheet" href="./style/themes/picard-site.css">
<script src="js/external/require.js" data-main="js/main.js"></script>
</head>
<body>
	
	<script>

		function API() {
			var api = this;
			this.__interval = setInterval(function() {
				api.__checkReady();
			}, 100);
		}
		API.prototype.getModel = function() {
			if(window.__app) {
				return window.__app.getModel();
			}
		}
		API.prototype.setStoryConnectionInfo = function(url,connectionType,dataFormat,connect) {
			if(this.isReady()) {
				this.getModel().story.$update({
					url: url,
					connectionType: connectionType || 'websocket',
					dataFormat: dataFormat || 'osc',
					connect: connect ? true : false
				});
			}
		}
		API.prototype.connect = function() {
			if(this.isReady()) {
				this.getModel().story.$update({connect: true});
			}
		}
		API.prototype.onReady = function(callback) {
			this.__callbacks.push(callback);
			this.__checkReady();
		}
		API.prototype.isReady = function() {
			return window.__app && window.__app.isStarted();
		}
		API.prototype.__checkReady = function() {
			if(this.isReady()) {
				if(this.__interval) {
					clearInterval(this.__interval);
					delete this.__interval;
				}
				while(this.__callbacks) {
					var callback = this.__callbacks.shift();
					callback();
				}
			}
		}

		window.api = new API();

	</script>

</body>
</html>